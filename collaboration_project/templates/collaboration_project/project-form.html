{% extends "myapp/base.html" %} 
{% load static %}

{% block title %}DevMate{% endblock %} 

{% block style %}
<link rel="stylesheet" href="{% static 'styles/user_profile_page.css' %}"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
{% endblock  %}
    
{% block body_class %}text-[15px] h-full bg-[#0e1217] overflow-x-hidden{% endblock %}

{% block content %}

    <!-- navbar -->
   {% include "includes/navbar.html" %}

    <!-- main section -->
    <div class="mt-20 w-full pb-20 lg:pb-10" id='entireSection'>
        <div class="flex justify-center flex-col items-center gap-y-4 w-[90%] md:w-1/2 lg:w-2/5 bg-[#1a1f2b] border border-[#2d323b] p-6 mx-auto rounded-xl shadow-lg">  
            <p class="text-2xl lg:text-3xl font-bold text-white mt-2 tracking-tight">Create a Project & <br>Find Collaborators ðŸš€</p>
            <div class="w-full mt-4">
                <form method="POST" enctype="multipart/form-data" id='projectForm' class="flex flex-col gap-y-5 w-full">
                    {% csrf_token %}
                    <div class="flex flex-col gap-y-1">
                        <label for="projectTitle" class='text-base text-gray-300'>{{form.title.label}}</label>
                        {{form.title}}
                        {% if form.title.errors %}
                            <ul class="errorlist text-red-500 font-normal" id="id_title_error">
                                {% for error in form.title.errors %}
                                    <li class="text-red-500 font-normal">{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div class="flex flex-col gap-y-1">
                        <label for="projectDescription" class='text-base text-gray-300'>{{form.description.label}}</label>
                        {{form.description}}
                        {% if form.description.errors %}
                            <ul class="errorlist text-red-500 font-normal" id="id_description_error">
                                {% for error in form.description.errors %}
                                    <li class="text-red-500 font-normal">{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div class="flex flex-col gap-y-2">
                        <label class='text-base text-gray-300'>{{ form.image.label }}</label>
                        <div class="text-xs text-gray-400">{{ form.image.help_text }}</div>
                        {{ form.image }}  
                        {% if form.instance.image %}
                            <div>
                                <p class="text-sm text-gray-400">Current: <a href="{{ form.instance.image.url }}" target="_blank" class="text-green-400 hover:text-green-300">View Image</a></p>
                            </div>
                        {% endif %}
                        {% if form.image.errors %}
                            <ul class="errorlist text-red-500 font-normal" id="id_image_error">
                                {% for error in form.image.errors %}
                                    <li class="text-red-500 font-normal">{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div class="flex flex-col gap-y-1">
                        <p class='text-base text-gray-300'>Required Skills</p>
                        {{form.skill_needed}}
                        {% if form.skill_needed.errors %}
                            <ul class="errorlist text-red-500 font-normal" id="id_skill_needed_error">
                                {% for error in form.skill_needed.errors %}
                                    <li class="text-red-500 font-normal">{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div class="flex gap-x-4 items-center">
                        <div class="flex flex-col gap-y-1 w-full">
                            <label for="projectLevel" class="text-base text-gray-300">{{form.level.label}}</label>
                            {{form.level}}
                        </div>
                        <div class="flex flex-col gap-y-1 w-full">
                            <label for="projectType" class='text-base text-gray-300'>{{form.type.label}}</label>
                            {{form.type}}
                        </div>
                    </div>
                    <div class="flex flex-col gap-y-1">
                        <label class='text-base text-gray-300'>Domain</label>
                        {{form.domain}}
                    </div>
                    <div class="flex gap-x-4 items-center">
                        <div class="flex flex-col gap-y-1 w-full">
                            <label class='text-base text-gray-300'>{{form.github_link.label}}</label>
                            {{form.github_link}}
                        </div>
                        <div class="flex flex-col gap-y-1 w-full">
                            <label class='text-base text-gray-300'>{{form.url.label}}</label>
                            {{form.url}}
                        </div>
                    </div>
                    <div class="flex gap-x-4 items-start">
                        <!-- File Field -->
                        <div class="flex flex-col gap-y-2 w-full">
                            <label for="{{ form.file.id_for_label }}" class="text-sm font-medium text-gray-300">Documentation</label>
                            {{ form.file }}  <!-- Hidden file input -->
                            <div class="flex gap-x-3 items-center border-dashed border-2 border-[#2d323b] bg-[#262b34] px-4 py-2 rounded-md cursor-pointer hover:bg-[#2a2f3c] hover:border-green-600/50 transition-all duration-200"
                                 onclick="document.getElementById('{{ form.file.id_for_label }}').click();">
                                <img src="{% static 'assets/fileUpload.svg' %}" alt="Upload File" class="w-6 h-6 filter brightness-0 invert">
                                <p class="text-gray-300 font-medium upload-text-file truncate" style="max-width: 150px;">
                                    {% if form.instance.file %}
                                    
                                        {{ form.instance.file.name|cut:"project/files/"|truncatechars:10 }}  <!-- Show filename -->
                                    {% else %}
                                        Upload File
                                    {% endif %}
                                </p>
                            </div>
                            {% if form.instance.file %}
                                <p class="text-sm text-gray-400">Current: <a href="{{ form.instance.file.url }}" target="_blank" class="text-green-400 hover:text-green-300">View File</a></p>
                            {% endif %}

                            {% if form.file.errors %}
                                <ul class="errorlist text-red-500 font-semibold" id="id_file_error">
                                    {% for error in form.file.errors %}
                                        <li class="text-red-500 font-normal">{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>

                        <!-- Video Field -->
                        <div class="flex flex-col gap-y-2 w-full">
                            <label for="{{ form.video.id_for_label }}" class="text-sm font-medium text-gray-300">Demo Video</label>
                            {{ form.video }}  <!-- Hidden video input -->
                            <div class="flex gap-x-3 items-center border-dashed border-2 border-[#2d323b] bg-[#262b34] px-4 py-2 rounded-md cursor-pointer hover:bg-[#2a2f3c] hover:border-green-600/50 transition-all duration-200"
                                 onclick="document.getElementById('{{ form.video.id_for_label }}').click();">
                                <img src="{% static 'assets/videoUpload.svg' %}" alt="Upload Video" class="w-6 h-6 filter brightness-0 invert">
                                <p class="text-gray-300 font-medium upload-text-video truncate" style="max-width: 150px;">
                                    {% if form.instance.video %}
                                        {{ form.instance.video.name|cut:"project/videos/"|truncatechars:10 }}  <!-- Show video filename -->
                                    {% else %}
                                        Upload Video
                                    {% endif %}
                                </p>
                            </div>
                            {% if form.instance.video %}
                                <p class="text-sm text-gray-400">Current: <a href="{{ form.instance.video.url }}" target="_blank" class="text-green-400 hover:text-green-300">View Video</a></p>
                            {% endif %}

                            {% if form.video.errors %}
                                <ul class="errorlist text-red-500 font-semibold" id="id_video_error">
                                    {% for error in form.video.errors %}
                                        <li class="text-red-500 font-normal">{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                    <div class="self-center flex gap-x-5">
                        <button id="projectSubmitButton" type="submit" class="flex items-center gap-2 bg-gradient-to-br from-green-600 to-green-900 hover:from-green-500 hover:to-green-800 text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition duration-300 hover:scale-105 cursor-pointer">
                            <i class="fa-solid fa-floppy-disk"></i> Save
                        </button>

                        {% if is_edit %}
                        <a href='{% url "delete_project" project_obj.uuid %}' class="bg-gradient-to-br from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition duration-300 hover:scale-105">Delete</a>
                        {% endif %}
                    </div>
                    {% if form.non_field_errors %}
                        <ul class="errorlist text-red-500 font-semibold">
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    {% include "includes/create-post.html" %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#mySelect').select2({
                placeholder: "Select Required Skills",
                allowClear: true,
                width: '100%',
            });
        });

        document.getElementById('{{ form.file.id_for_label }}').addEventListener('change', function(event) {
            const fileInput = event.target;
            const uploadText = fileInput.parentElement.querySelector('.upload-text-file');
            if (fileInput.files.length > 0) {
                let fileName = fileInput.files[0].name;
                if (fileName.length > 10) {
                    fileName = fileName.substring(0, 9) + '...'; // Truncate to 7 chars + '...'
                }
                uploadText.textContent = fileName; // Display the selected file name
            } else {
                uploadText.textContent = 'Upload File'; // Reset to default if no file is selected
            }
        });
    
        // For Video Field
        document.getElementById('{{ form.video.id_for_label }}').addEventListener('change', function(event) {
            const fileInput = event.target;
            const uploadText = fileInput.parentElement.querySelector('.upload-text-video');
            if (fileInput.files.length > 0) {
                let fileName = fileInput.files[0].name;
                if (fileName.length > 10) {
                    fileName = fileName.substring(0, 9) + '...';
                }
                uploadText.textContent = fileName;
            } else {
                uploadText.textContent = 'Upload Video';
            }
        });

        //Disable sbt btn for project, when loading.
        $(document).ready(function () {
            $('#projectForm').on('submit', function () {
                const submitBtn = $('#projectSubmitButton');
                submitBtn.prop("disabled", true);
                submitBtn.html(`<i class="fa-solid fa-spinner fa-spin mr-2"></i> Posting...`);
            });
        });

    </script>
{% endblock %}
{% extends "myapp/base.html" %} 
{% load static %}
{% load custom_filter %}

{% block title %}
    {% if request.GET.list == 'following' %}Following{% elif request.GET.list == 'mutuals' %}Mutuals{% else %}Followers{% endif %} Â· {{ userinfo_obj.user.username }}
{% endblock %} 

{% block style %}
<link rel="stylesheet" href="{% static 'styles/user_profile_page.css' %}"/>
{% endblock %} 

{% block body_class %}text-[14px] h-full bg-[#0d1117] text-[#c9d1d9] overflow-x-hidden{% endblock %}

{% block content %}

<div class="flex flex-col lg:flex-row min-h-screen">
    
    <!-- Sidenav -->
    {% include "includes/sidenav.html" %}

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8 w-full">
        
        <!-- Modern Header -->
        <div class="w-full max-w-xl mb-8">
            <!-- Breadcrumb / Back -->
            <nav class="flex items-center gap-2 text-xs text-[#8b949e] mb-4 font-medium">
                <a href="{% url 'index' %}" class="hover:text-green-600 transition-colors">Home</a>
                <span class="text-[#30363d]">/</span>
                <a href="{% url 'user_profile' userinfo_obj.user.username %}" class="hover:text-green-600 transition-colors">{{ userinfo_obj.user.username }}</a>
                <span class="text-[#30363d]">/</span>
                <span class="text-[#c9d1d9]">Network</span>
            </nav>

            <!-- Title Section -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-2xl sm:text-3xl font-bold text-white tracking-tight mb-1.5">
                        {% if request.GET.list == 'following' %}Following{% elif request.GET.list == 'mutuals' %}Mutuals{% else %}Followers{% endif %}
                    </p>
                    <p class="text-[#8b949e] text-sm">
                        People connected with <span class="text-[#c9d1d9] font-medium">@{{ userinfo_obj.user.username }}</span>
                    </p>
                </div>
                <a href="{% url 'user_profile' userinfo_obj.user.username %}" class=" sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border border-[#30363d] bg-[#21262d] text-xs font-medium text-[#c9d1d9] hover:bg-[#30363d] hover:text-white transition-all shadow-sm">
                    <i class="fa-solid fa-arrow-left"></i> Back
                </a>
            </div>
        </div>

        <!-- Main Card -->
        <div class="w-full max-w-xl -mt-2 bg-[#161b22] border border-[#30363d] rounded-xl overflow-hidden shadow-sm ring-1 ring-white/5">
            
            <!-- Switch Component (Tabs) -->
            <div class="p-4 border-b border-[#30363d]">
                <div class="flex p-1 bg-[#0d1117] rounded-lg border border-[#30363d] overflow-x-auto custom-scrollbar">
                    <a href="?list=followers" class="flex-1 min-w-[120px] whitespace-nowrap py-1.5 text-center text-sm font-medium rounded-md transition-all duration-200
                        {% if request.GET.list == 'followers' or request.GET.list == None %}
                            bg-[#21262d] text-white shadow-sm ring-1 ring-white/10
                        {% else %}
                            text-[#8b949e] hover:text-[#c9d1d9] hover:bg-[#21262d]/50
                        {% endif %}">
                        Followers <span class="ml-1.5 text-xs opacity-70 bg-[#30363d] px-1.5 py-0.5 rounded-full">{{ followers_count }}</span>
                    </a>
                    <a href="?list=following" class="flex-1 min-w-[120px] whitespace-nowrap py-1.5 text-center text-sm font-medium rounded-md transition-all duration-200
                        {% if request.GET.list == 'following' %}
                            bg-[#21262d] text-white shadow-sm ring-1 ring-white/10
                        {% else %}
                            text-[#8b949e] hover:text-[#c9d1d9] hover:bg-[#21262d]/50
                        {% endif %}">
                        Following <span class="ml-1.5 text-xs opacity-70 bg-[#30363d] px-1.5 py-0.5 rounded-full">{{ following_count }}</span>
                    </a>
                    {% if not is_self %}
                    <a href="?list=mutuals" class="flex-1 min-w-[120px] whitespace-nowrap py-1.5 text-center text-sm font-medium rounded-md transition-all duration-200
                        {% if request.GET.list == 'mutuals' %}
                            bg-[#21262d] text-white shadow-sm ring-1 ring-white/10
                        {% else %}
                            text-[#8b949e] hover:text-[#c9d1d9] hover:bg-[#21262d]/50
                        {% endif %}">
                        Mutuals <span class="ml-1.5 text-xs opacity-70 bg-[#30363d] px-1.5 py-0.5 rounded-full">{{ mutuals_count }}</span>
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- List Content -->
            <div class="divide-y divide-[#30363d] max-h-[65vh] overflow-y-auto custom-scrollbar bg-[#0d1117]/20">
                {% if user_list %}
                    {% for people in user_list %}
                    <div class="flex items-center justify-between px-4 py-4 hover:bg-[#21262d]/40 transition-colors group">
                        
                        <!-- User Info -->
                        <div class="flex items-center gap-4 flex-1 min-w-0">
                            <a href="{% url 'user_profile' people.user.username %}" class="relative shrink-0">
                                <img src="{{people.profile_image.url}}?v={{people.updated_at.timestamp}}" 
                                     class="w-12 h-12 rounded-full border-2 border-[#30363d] object-cover group-hover:bg-green-600 transition-colors" 
                                     alt="{{people.user.username}}">
                                {% if people.last_seen|is_online %}
                                    <span class="absolute bottom-0.5 right-0.5 w-3 h-3 bg-[#3fb950] border-2 border-[#161b22] rounded-full" title="Online"></span>
                                {% endif %}
                            </a>
                            
                            <div class="flex flex-col min-w-0">
                                <a href="{% url 'user_profile' people.user.username %}" class="text-[15px] font-semibold text-white hover:text-green-600 hover:underline truncate transition-colors">
                                    {{people.user.username}}
                                </a>
                                <div class="flex items-center gap-2 text-xs text-[#8b949e] mt-0.5">
                                    <span class="truncate max-w-[120px]">{{people.user.first_name}} {{people.user.last_name}}</span>
                                    {% if people.coding_style %}
                                            <img src="{% static 'assets/coding-style-logo/' %}{{people.coding_style.logo}}" 
                                                 class="w-4 h-4 opacity-80" 
                                                 alt="{{people.coding_style.name}}">
                                            {% comment %} <span class="font-medium text-[10px]">{{people.coding_style.name}}</span> {% endcomment %}
                                        
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="ml-4 shrink-0">
                            {% if user.info == people %}
                                <!-- Self -->
                            {% else %}
                                {% if user.info|is_following:people %}
                                    <a href="javascript:void(0);" class="follow-btn bg-[#262b34] text-white py-2 text-center rounded-md inline-block min-w-[100px]" data-user-id="{{ people.id }}">
                                        <span class="btn-text">&lt;Unfollow/&gt;</span>
                                    </a>
                                {% else %}
                                    <a href="javascript:void(0);" class="follow-btn bg-[#6feb85] text-black text-center py-2 rounded-md inline-block min-w-[100px]" data-user-id="{{ people.id }}">
                                        <span class="btn-text">&lt;Follow/&gt;</span>
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="flex flex-col items-center justify-center py-20 px-4 text-center">
                        <div class="w-16 h-16 bg-[#21262d] rounded-full flex items-center justify-center mb-4 border border-[#30363d] shadow-sm">
                            <i class="fa-solid fa-user-group text-[#8b949e] text-2xl"></i>
                        </div>
                        <h3 class="text-white font-semibold text-lg mb-1">No connections yet</h3>
                        <p class="text-[#8b949e] text-sm max-w-xs mx-auto">
                            {% if request.GET.list == 'following' %}
                                {{ userinfo_obj.user.username }} isn't following anyone.
                            {% elif request.GET.list == 'mutuals' %}
                                No mutual connections found.
                            {% else %}
                                {{ userinfo_obj.user.username }} doesn't have any followers.
                            {% endif %}
                        </p>
                    </div>
                {% endif %}
            </div>

            <!-- Pagination -->
            {% if user_list.paginator.num_pages > 1 %}
            <div class="border-t border-[#30363d] bg-[#161b22] p-3 flex justify-center">
                <div class="flex items-center gap-1 bg-[#0d1117] p-1 rounded-lg border border-[#30363d]">
                    {% if user_list.has_previous %}
                        <a href="?list={{request.GET.list}}&page={{user_list.previous_page_number}}" class="p-1.5 text-[#8b949e] hover:text-[#58a6ff] hover:bg-[#21262d] transition-all rounded-md">
                            <i class="fa-solid fa-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="p-1.5 text-[#484f58] cursor-not-allowed">
                            <i class="fa-solid fa-chevron-left"></i>
                        </span>
                    {% endif %}
                    
                    <span class="text-xs text-[#c9d1d9] font-medium px-3 py-1">
                        Page {{ user_list.number }} of {{ user_list.paginator.num_pages }}
                    </span>

                    {% if user_list.has_next %}
                        <a href="?list={{request.GET.list}}&page={{user_list.next_page_number}}" class="p-1.5 text-[#8b949e] hover:text-[#58a6ff] hover:bg-[#21262d] transition-all rounded-md">
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="p-1.5 text-[#484f58] cursor-not-allowed">
                            <i class="fa-solid fa-chevron-right"></i>
                        </span>
                    {% endif %}
                </div>
            </div>
            {% endif %}

        </div>
    </main>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #30363d;
        border-radius: 20px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background-color: #8b949e;
    }
</style>

{% endblock %}
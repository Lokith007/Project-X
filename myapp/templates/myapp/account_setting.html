{% extends "myapp/base.html" %} 
{% load static %}
{% load i18n %}

{% block title %}Settings{% endblock %} 

{% block content %}

<div class="min-h-screen bg-[#010409] text-[#c9d1d9] font-sans flex flex-col lg:flex-row">
    
    <!-- Global Sidenav -->
    {% include "includes/sidenav.html" with active_settings=True %}

    <!-- Main Content Area -->
    <div class="flex-1 min-w-0 flex flex-col">
        
        <!-- Top Navigation Bar -->
        <div class="sticky -ml-4 top-0 z-20 bg-[#161b22] backdrop-blur-md border-b border-[#30363d]">
            <div class="max-w-[1000px] mx-auto px-4 md:px-6 h-15 flex items-center justify-between">
                <div class="flex items-center gap-4 mx-auto">

                    <p class="text-xl font-light text-[#c9d1d9] mx-auto">Account Center</p>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="w-full max-w-[800px] mx-auto px-4 md:px-6 py-8 pb-24 lg:pb-8"> <!-- Added pb-24 for mobile nav clearance -->
            
            <div class="space-y-6">
                
                <!-- Profile Card -->
                <div class="bg-[#161b22] border border-[#30363d] rounded-2xl p-6 flex flex-col sm:flex-row items-center sm:items-start gap-6 shadow-sm">
                    <div class="relative group">
                        <img src="{{userinfo_obj.profile_image.url}}?v={{userinfo_obj.updated_at.timestamp}}" alt="Profile Picture" 
                             class="w-20 h-20 rounded-full border-2 border-[#30363d] shadow-md group-hover:border-[#58a6ff] transition-colors">
                        <a href="{% url 'user_profile' user.username %}" class="absolute bottom-0 right-0 w-7 h-7 bg-[#21262d] border border-[#30363d] rounded-full flex items-center justify-center text-[#c9d1d9] hover:bg-[#58a6ff] hover:text-white hover:border-transparent transition-all shadow-sm">
                            <i class="fa-solid fa-pencil text-xs"></i>
                        </a>
                    </div>
                    <div class="text-center sm:text-left flex-1">
                        <h2 class="text-xl font-semibold text-[#c9d1d9]">{{user.username}}</h2>
                        <p class="text-sm text-[#8b949e] mt-1">{{user.email}}</p>
                        <div class="mt-4 flex flex-wrap justify-center sm:justify-start gap-2">
                            {% if user.has_usable_password %}
                            <span class="px-2.5 py-1 text-xs font-medium text-[#3fb950] bg-[#3fb950]/10 border border-[#3fb950]/20 rounded-full">
                                Password Set
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Settings Sections -->
                <div class="bg-[#161b22] border border-[#30363d] rounded-2xl overflow-hidden shadow-sm">
                    
                    <!-- Email -->
                    <div class="p-5 flex items-center justify-between border-b border-[#30363d] hover:bg-[#21262d]/50 transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-[#21262d] border border-[#30363d] flex items-center justify-center text-[#c9d1d9]">
                                <i class="fa-regular fa-envelope"></i>
                            </div>
                            <div>
                                <div class="text-[#c9d1d9] font-medium text-sm">Email Address</div>
                                <div class="text-xs text-[#8b949e] mt-0.5">{{user.email}}</div>
                            </div>
                        </div>
                        <a href="{% url 'account_email' %}" class="px-3 py-1.5 text-xs font-medium text-[#c9d1d9] bg-[#21262d] border border-[#30363d] rounded-lg hover:bg-[#30363d] hover:border-[#8b949e] transition-all">
                            Manage
                        </a>
                    </div>

                    <!-- Password -->
                    <div class="p-5 flex items-center justify-between border-b border-[#30363d] hover:bg-[#21262d]/50 transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-[#21262d] border border-[#30363d] flex items-center justify-center text-[#c9d1d9]">
                                <i class="fa-solid fa-lock"></i>
                            </div>
                            <div>
                                <div class="text-[#c9d1d9] font-medium text-sm">Password</div>
                                <div class="text-xs text-[#8b949e] mt-0.5">
                                    {% if user.has_usable_password %}Last changed recently{% else %}Not set{% endif %}
                                </div>
                            </div>
                        </div>
                        {% if user.has_usable_password %}
                        <a href="{% url 'account_change_password' %}" class="px-3 py-1.5 text-xs font-medium text-[#c9d1d9] bg-[#21262d] border border-[#30363d] rounded-lg hover:bg-[#30363d] hover:border-[#8b949e] transition-all">
                            Change
                        </a>
                        {% else %}
                        <a href="{% url 'account_set_password' %}" class="px-3 py-1.5 text-xs font-medium text-white bg-[#238636] border border-[#2ea043] rounded-lg hover:bg-[#2ea043] transition-all shadow-sm">
                            Set Password
                        </a>
                        {% endif %}
                    </div>

                    <!-- Social Accounts -->
                    <div class="p-5 flex items-center justify-between border-b border-[#30363d] hover:bg-[#21262d]/50 transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-[#21262d] border border-[#30363d] flex items-center justify-center text-[#c9d1d9]">
                                <i class="fa-brands fa-connectdevelop"></i>
                            </div>
                            <div>
                                <div class="text-[#c9d1d9] font-medium text-sm">Social Accounts</div>
                                <div class="text-xs text-[#8b949e] mt-0.5">Connected apps and integrations</div>
                            </div>
                        </div>
                        <a href="/accounts/3rdparty" class="px-3 py-1.5 text-xs font-medium text-[#c9d1d9] bg-[#21262d] border border-[#30363d] rounded-lg hover:bg-[#30363d] hover:border-[#8b949e] transition-all">
                            Configure
                        </a>
                    </div>

                    <!-- Timezone -->
                    <div class="p-5 flex items-center justify-between hover:bg-[#21262d]/50 transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-[#21262d] border border-[#30363d] flex items-center justify-center text-[#c9d1d9]">
                                <i class="fa-solid fa-globe"></i>
                            </div>
                            <div>
                                <div class="text-[#c9d1d9] font-medium text-sm">Timezone</div>
                                <div class="text-xs text-[#8b949e] mt-0.5">Local time display</div>
                            </div>
                        </div>
                        <form method="POST" action="{% url 'settings_page' %}" class="flex items-center gap-2">
                            {% csrf_token %}
                            <select name="timezone" class="bg-[#0d1117] border border-[#30363d] text-[#c9d1d9] text-xs rounded-lg px-2.5 py-1.5 focus:border-[#58a6ff] focus:ring-1 focus:ring-[#58a6ff] focus:outline-none max-w-[140px] sm:max-w-none">
                                {% for tz_value, tz_label in timezone_choices %}
                                <option value="{{ tz_value }}" {% if tz_value == userinfo_obj.timezone %}selected{% endif %}>{{ tz_label }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="px-3 py-1.5 text-xs font-medium text-[#c9d1d9] bg-[#21262d] border border-[#30363d] rounded-lg hover:bg-[#30363d] hover:border-[#8b949e] transition-all">
                                Save
                            </button>
                        </form>
                    </div>

                </div>

                <!-- Danger Zone -->
                <div class="pt-6">
                    <h3 class="text-sm font-semibold text-[#f85149] mb-3 px-1">Danger Zone</h3>
                    <div class="bg-[#161b22] border border-[#f85149]/40 rounded-2xl overflow-hidden">
                        <div class="p-5 flex items-center justify-between">
                            <div>
                                <div class="text-[#c9d1d9] font-medium text-sm">Delete Account</div>
                                <div class="text-xs text-[#8b949e] mt-0.5">Permanently remove your account and data</div>
                            </div>
                            <button id="delete-btn" class="px-3 py-1.5 text-xs font-medium text-[#f85149] bg-[#161b22] border border-[#f85149]/40 rounded-lg hover:bg-[#da3633] hover:text-white hover:border-transparent transition-all">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/70 backdrop-blur-sm transition-opacity"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div class="relative transform overflow-hidden rounded-2xl bg-[#161b22] border border-[#30363d] text-left shadow-2xl transition-all w-full max-w-md">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 rounded-full bg-[#da3633]/10 flex items-center justify-center flex-shrink-0">
                                <i class="fa fa-exclamation-triangle text-[#da3633] text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-[#c9d1d9]" id="modal-title">Delete account</h3>
                                <p class="text-sm text-[#8b949e]">This action is irreversible.</p>
                            </div>
                        </div>
                        <p class="text-sm text-[#8b949e] mb-6">Are you sure you want to delete your account? All of your data, logs, and connections will be permanently removed.</p>
                        
                        <div class="flex items-center gap-3 justify-end">
                            <button id="cancel-btn" type="button" class="px-4 py-2 text-sm font-medium text-[#c9d1d9] bg-[#21262d] border border-[#30363d] rounded-xl hover:bg-[#30363d] transition-colors">Cancel</button>
                            <form method="POST" action="{% url 'delete_acount' user.info.uuid %}">
                                {% csrf_token %}
                                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-[#da3633] rounded-xl hover:bg-[#b62324] transition-colors shadow-lg shadow-[#da3633]/20">Delete Account</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const deleteBtn = document.getElementById("delete-btn");
        const modal = document.getElementById("modal");
        const cancelBtn = document.getElementById("cancel-btn");
    
        deleteBtn.addEventListener("click", () => {
            modal.classList.remove("hidden");
        });
    
        cancelBtn.addEventListener("click", () => {
            modal.classList.add("hidden");
        });

        modal.addEventListener("click", (e) => {
            if (e.target.closest('.relative') === null) {
                modal.classList.add("hidden");
            }
        });
    });
</script>

{% endblock %}
